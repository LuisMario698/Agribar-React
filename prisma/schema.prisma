// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Empleado {
  id              Int       @id @default(autoincrement())
  clave           String    @unique
  nombre          String
  apellidoPaterno String
  apellidoMaterno String?
  curp            String    @unique
  rfc             String?
  nss             String?
  estadoOrigen    String?
  activo          Boolean   @default(true) // estado
  registroPatronal String?
  fechaIngreso    DateTime
  fechaRegistro   DateTime  @default(now())
  sueldoDiario    Float
  descuentoInfonavit Float  @default(0)
  tieneInfonavit  Boolean   @default(false)
  enCuadrilla     Boolean   @default(false)
  
  cuadrillaId     Int?
  cuadrilla       Cuadrilla? @relation(fields: [cuadrillaId], references: [id])
  
  nominas         Nomina[]
  
  actualizadoEn   DateTime  @updatedAt
}

model Cuadrilla {
  id            Int        @id @default(autoincrement())
  clave         String     @unique
  nombre        String
  grupo         String?
  actividad     String?    // Podría ser relación si Actividad es estricta
  activo        Boolean    @default(true) // estado
  fechaRegistro DateTime   @default(now())
  actualizadoEn DateTime   @updatedAt
  
  empleados     Empleado[]
  nominas       Nomina[]
}

model Actividad {
  id            Int      @id @default(autoincrement())
  clave         String   @unique
  nombre        String
  fechaRegistro DateTime @default(now())
  actualizadoEn DateTime @updatedAt
}

model Periodo {
  id          Int      @id @default(autoincrement())
  clave       String   @unique
  fechaInicio DateTime
  fechaFin    DateTime
  totalDias   Int
  fechaPago   DateTime
  anio        Int
  tipoPeriodo TipoPeriodo
  nominas     Nomina[]
}

enum TipoPeriodo {
  SEMANAL
  QUINCENAL
  CATORCENAL
  ESPECIAL
}

model Nomina {
  id            Int      @id @default(autoincrement())
  clave         String?  @unique
  
  periodoId     Int
  periodo       Periodo  @relation(fields: [periodoId], references: [id])
  
  empleadoId    Int
  empleado      Empleado @relation(fields: [empleadoId], references: [id])
  
  cuadrillaId   Int?
  cuadrilla     Cuadrilla? @relation(fields: [cuadrillaId], references: [id])
  
  // Arrays y Datos Financieros
  pagoPorDia       Float[]    // Array de PostgreSQL
  campoPorDia      String[]   // Array de PostgreSQL
  actividadPorDia  String[]   // Array de PostgreSQL
  
  total       Float
  subtotal    Float
  descuento   Float
  extras      Float
  comedor     Float
  
  estado      EstadoNomina @default(ABIERTA)
  
  fechaCierre     DateTime?
  usuarioCierreId Int?
  usuarioCierre   Usuario? @relation("UsuarioCierre", fields: [usuarioCierreId], references: [id])
  
  fechaCreacion   DateTime @default(now())
  usuarioCreoId   Int?
  usuarioCreo     Usuario? @relation("UsuarioCreo", fields: [usuarioCreoId], references: [id])
  
  actualizadoEn   DateTime @updatedAt
}

enum EstadoNomina {
  ABIERTA
  CERRADA
}

model Campo {
  id          Int      @id @default(autoincrement())
  clave       String   @unique
  nombre      String
  descripcion String?
}

model Usuario {
  id          Int      @id @default(autoincrement())
  clave       String   @unique
  nombre      String
  email       String   @unique
  password    String
  contacto    String?
  
  rolId       Int
  rol         Rol      @relation(fields: [rolId], references: [id])
  
  nominasCreadas  Nomina[] @relation("UsuarioCreo")
  nominasCerradas Nomina[] @relation("UsuarioCierre")
}

model Rol {
  id          Int       @id @default(autoincrement())
  clave       String    @unique
  nombre      String    // Capturista, Administrador, Supervisor
  descripcion String?
  usuarios    Usuario[]
}
