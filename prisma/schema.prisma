generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Empleado {
  id                 Int         @id @default(autoincrement())
  nombre             String
  activo             Boolean     @default(true)
  actualizadoEn      DateTime    @updatedAt
  apellidoMaterno    String?
  apellidoPaterno    String
  clave              String      @unique
  curp               String      @unique
  descuentoInfonavit Float       @default(0)
  enCuadrilla        Boolean     @default(false)
  estadoOrigen       String?
  fechaIngreso       DateTime
  fechaRegistro      DateTime    @default(now())
  nss                String?
  registroPatronal   String?
  rfc                String?
  sueldoDiario       Float
  tieneInfonavit     Boolean     @default(false)
  nominas            Nomina[]
  cuadrillas         Cuadrilla[] @relation("CuadrillaToEmpleado")
}

model Cuadrilla {
  id            Int        @id @default(autoincrement())
  clave         String     @unique
  nombre        String
  grupo         String?
  actividad     String?
  activo        Boolean    @default(true)
  fechaRegistro DateTime   @default(now())
  actualizadoEn DateTime   @updatedAt
  nominas       Nomina[]
  empleados     Empleado[] @relation("CuadrillaToEmpleado")
}

model Actividad {
  id            Int      @id @default(autoincrement())
  clave         String   @unique
  nombre        String
  fechaRegistro DateTime @default(now())
  actualizadoEn DateTime @updatedAt
}

model Periodo {
  id          Int         @id @default(autoincrement())
  clave       String      @unique
  fechaInicio DateTime
  fechaFin    DateTime
  totalDias   Int
  fechaPago   DateTime
  anio        Int
  tipoPeriodo TipoPeriodo
  activo      Boolean     @default(true)
  nominas     Nomina[]
}

model Nomina {
  id              Int          @id @default(autoincrement())
  clave           String?      @unique
  periodoId       Int
  empleadoId      Int
  cuadrillaId     Int?
  pagoPorDia      Float[]
  campoPorDia     String[]
  actividadPorDia String[]
  total           Float
  subtotal        Float
  descuento       Float
  extras          Float
  comedor         Float
  estado          EstadoNomina @default(ABIERTA)
  fechaCierre     DateTime?
  usuarioCierreId Int?
  fechaCreacion   DateTime     @default(now())
  usuarioCreoId   Int?
  actualizadoEn   DateTime     @updatedAt
  cuadrilla       Cuadrilla?   @relation(fields: [cuadrillaId], references: [id])
  empleado        Empleado     @relation(fields: [empleadoId], references: [id])
  periodo         Periodo      @relation(fields: [periodoId], references: [id])
  usuarioCierre   Usuario?     @relation("UsuarioCierre", fields: [usuarioCierreId], references: [id])
  usuarioCreo     Usuario?     @relation("UsuarioCreo", fields: [usuarioCreoId], references: [id])
}

model Campo {
  id          Int     @id @default(autoincrement())
  clave       String  @unique
  nombre      String
  descripcion String?
}

model Usuario {
  id              Int      @id @default(autoincrement())
  clave           String   @unique
  nombre          String
  email           String   @unique
  password        String
  contacto        String?
  rolId           Int
  nominasCerradas Nomina[] @relation("UsuarioCierre")
  nominasCreadas  Nomina[] @relation("UsuarioCreo")
  rol             Rol      @relation(fields: [rolId], references: [id])
}

model Rol {
  id          Int       @id @default(autoincrement())
  clave       String    @unique
  nombre      String
  descripcion String?
  usuarios    Usuario[]
}

enum TipoPeriodo {
  SEMANAL
  QUINCENAL
  CATORCENAL
  ESPECIAL
}

enum EstadoNomina {
  ABIERTA
  CERRADA
}
